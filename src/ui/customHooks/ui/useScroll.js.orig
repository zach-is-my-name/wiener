import {parse, stringify, toJSON, fromJSON} from 'flatted';
import {_logger, logger2, logger3, logger} from '../../../devLog/logger.js' 
logger.level = "debug"
import {useEffect} from 'react'

export function useScroll(refs, state, dispatch, lineFromSearch, setLineFromSearch) {
<<<<<<< HEAD
  const [{mainBoxRef, isFirstRender, scrollToZeroFlag, scrollToScrollHeightFlag}] = refs
=======
  const [{mainBoxRef, scrollToZeroFlag, scrollToScrollHeightFlagRef}] = refs
>>>>>>> a3d76c2 (fix scroll bug; remove comments)

  const {cursorLeft, cursorTop} = state 
  
  useEffect(() => {
    if (lineFromSearch?.length) {
      const lines = mainBoxRef.current?.getScreenLines()
      const i = lines.findIndex(el => el === lineFromSearch)
       mainBoxRef.current?.scrollTo(i);
       dispatch({type: "setCursorTop", payload: i})
       setLineFromSearch(null);
    }
  }, [lineFromSearch])

  useEffect(() => {
    // logger.debug("ran useEffect -> useScroll")  
    mainBoxRef.current?.scrollTo(cursorTop);

<<<<<<< HEAD
    if (scrollToScrollHeightFlag?.current) {

      mainBoxRef.current?.scrollTo(mainBoxRef.currrent.getScrollHeight())
=======
    if (scrollToScrollHeightFlagRef.current) {
     
      mainBoxRef?.current?.scrollTo(mainBoxRef.current?.getScrollHeight())
>>>>>>> a3d76c2 (fix scroll bug; remove comments)
    } else if (scrollToZeroFlag?.current) {

      mainBoxRef?.current?.scrollTo(0)
    }

<<<<<<< HEAD
    // return () => {
    //   dispatch({type: "setStateCallbackFlag"})
    //   // scrollToScrollHeightFlag.current = false 
    //   scrollToZeroFlag.current = false
    // }
  }, [cursorLeft, cursorTop, stateCallbackFlag])
=======
  }, [cursorLeft, cursorTop])
>>>>>>> a3d76c2 (fix scroll bug; remove comments)
}

