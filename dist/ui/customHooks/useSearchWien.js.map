{"version":3,"file":"useSearchWien.js","names":["cliTruncate","fs","chalk","stripAnsi","Fuse","join","dirname","fileURLToPath","Low","JSONFile","__dirname","import","meta","url","file","adapter","db","read","useSearchWien","textBoxInput","setItems","setDateIndex","options","includeMatches","findAllMatches","minMatchCharLength","threshold","ignoreLocation","shouldSort","keys","newsletters","data","length","index","createIndex","fuse","searchResults","search","map","resObj","hlQueryMatch","date","item","line","matches","value","indexStart","indexEnd","sliceEnd","fragment","hlFragment","_stripAnsi","trim","position","indices","slice","bgAnsi256","replace","string","removeMdLinks"],"sources":["../../../src/ui/customHooks/useSearchWien.js"],"sourcesContent":["import cliTruncate from 'cli-truncate'\nimport fs from 'fs'\nimport chalk from 'chalk';\nimport stripAnsi from 'strip-ansi'\nimport Fuse from 'fuse.js'\nimport { join, dirname } from 'node:path'\nimport { fileURLToPath } from 'node:url'\n\nimport { Low } from 'lowdb'\nimport { JSONFile } from 'lowdb/node'\n\nconst __dirname = dirname(fileURLToPath(import.meta.url)); //production db file\nconst file = join(__dirname, 'db.json')\nconst adapter = new JSONFile(file)\nconst db = new Low(adapter)\n\nawait db.read()\n\nexport function useSearchWien(textBoxInput, setItems, setDateIndex) {\n  const options = {\n    includeMatches: true,\n    findAllMatches: true,\n    minMatchCharLength: 3,\n    threshold: 0.2,\n    ignoreLocation: true,\n    shouldSort: false,\n    keys: ['text']\n  }\n  let newsletters\n  if (db.data?.newsletters && db.data.newsletters.length) {\n   newsletters = db.data.newsletters \n  } else {\n    newsletters = []\n  }\n  const index = Fuse.createIndex(options.keys, newsletters) \n  const fuse = new Fuse(newsletters, options, index)\n  let searchResults = fuse.search(textBoxInput) || []\n\n  setItems(searchResults.map((resObj, index) => hlQueryMatch(resObj, index)))\n\n  setDateIndex(searchResults.map((resObj, index) => ({index, date: resObj.item.date, line: resObj.matches[0].value })))\n}\n\nfunction hlQueryMatch (resObj, index) {\n  let {date} = resObj.item\n  let {value} = resObj.matches[0]\n  let indexStart, indexEnd, sliceEnd, fragment, hlFragment\n  value = cliTruncate(_stripAnsi(value).trim(), 70, {position: \"end\"}); \n  [indexStart, indexEnd] = resObj.matches[0].indices[0]\n  sliceEnd = indexEnd + 1\n  fragment =  value.slice(indexStart, sliceEnd)\n  hlFragment = chalk.bgAnsi256(103)(fragment);\n  value = value.replace(fragment, hlFragment, value)\n  return `${date}:  ${value}` \n}\n\nfunction _stripAnsi(string) {\n  return stripAnsi(string)\n}\n\nfunction removeMdLinks(string, value, index) {\n  return string.replace(/\\[([^\\[]+)\\](\\(.*\\))/,'$1' )\n}\n\n\n"],"mappings":"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"}