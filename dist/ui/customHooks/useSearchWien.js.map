{"version":3,"file":"useSearchWien.js","names":["cliTruncate","chalk","stripAnsi","Fuse","loadNewsletterFromDb","useSearchWien","textBoxInput","setItems","setDateIndex","ctrDispatch","isMounted","current","newsletters","options","includeMatches","findAllMatches","minMatchCharLength","threshold","ignoreLocation","shouldSort","keys","length","console","clear","type","payload","index","createIndex","fuse","searchResults","search","map","resObj","hlQueryMatch","date","item","line","matches","value","indexStart","indexEnd","sliceEnd","fragment","hlFragment","_stripAnsi","trim","position","indices","slice","bgAnsi256","replace","string","removeMdLinks"],"sources":["../../../src/ui/customHooks/useSearchWien.js"],"sourcesContent":["import cliTruncate from 'cli-truncate'\nimport chalk from 'chalk';\nimport stripAnsi from 'strip-ansi'\nimport Fuse from 'fuse.js'\nimport {loadNewsletterFromDb} from '../../db/db.js' \n\n\nexport async function useSearchWien(textBoxInput, setItems, setDateIndex, ctrDispatch, isMounted) {\n\nif (isMounted.current === false) return \nlet newsletters = await loadNewsletterFromDb(\"all\")\n\n  const options = {\n    includeMatches: true,\n    findAllMatches: true,\n    minMatchCharLength: 3,\n    threshold: 0.2,\n    ignoreLocation: true,\n    shouldSort: false,\n    keys: ['text']\n  }\n  if (!newsletters?.length) {\n    newsletters = []\n    console.clear()\n    ctrDispatch({type: \"setPopUpMessage\", payload: \"Wait for newsletters to sync before searching\"})\n    ctrDispatch({type: \"exitSearchPage\"}) \n  }\n\n  \n\n  const index = Fuse.createIndex(options.keys, newsletters) \n  const fuse = new Fuse(newsletters, options, index)\n  let searchResults = fuse.search(textBoxInput) || []\n\n  setItems(searchResults.map((resObj, index) => hlQueryMatch(resObj, index)))\n\n  setDateIndex(searchResults.map((resObj, index) => ({index, date: resObj.item.date, line: resObj.matches[0].value })))\n}\n\nfunction hlQueryMatch (resObj, index) {\n  let {date} = resObj.item\n  let {value} = resObj.matches[0]\n  let indexStart, indexEnd, sliceEnd, fragment, hlFragment\n  value = cliTruncate(_stripAnsi(value).trim(), 70, {position: \"end\"}); \n  [indexStart, indexEnd] = resObj.matches[0].indices[0]\n  sliceEnd = indexEnd + 1\n  fragment =  value.slice(indexStart, sliceEnd)\n  hlFragment = chalk.bgAnsi256(103)(fragment);\n  value = value.replace(fragment, hlFragment, value)\n  return `${date}:  ${value}` \n}\n\nfunction _stripAnsi(string) {\n  return stripAnsi(string)\n}\n\nfunction removeMdLinks(string, value, index) {\n  return string.replace(/\\[([^\\[]+)\\](\\(.*\\))/,'$1' )\n}\n\n\n"],"mappings":"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"}