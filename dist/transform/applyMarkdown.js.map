{"version":3,"file":"applyMarkdown.js","names":["cheerio","TurndownService","chalk","figures","mainSymbols","blessed","figlet","stripAnsi","turndownOptions","headingStyle","bulletListMarker","turndownFilter","turndownService","remove","applyMarkdown","sourceHtml","$","load","children","contents","unwrap","html","root","addRule","filter","node","content","test","className","replacement","noBreakTag","replace","noLineBreak","bullet","nodeType","localName","textContent","match","stripTags","trim","orgLinkRegex","orgFirstWordRegex","whiteBright","textSync","text","bgAnsi256","bold","url","getAttribute","turndown","markdown"],"sources":["../../src/transform/applyMarkdown.js"],"sourcesContent":["import cheerio from 'cheerio'\nimport TurndownService from 'turndown';\nimport chalk from 'chalk';\nimport figures, {mainSymbols} from 'figures';\nimport blessed from 'blessed'\nimport figlet from 'figlet'\nimport stripAnsi from 'strip-ansi'\nconst turndownOptions = {\n  headingStyle: 'atx',\n  bulletListMarker: '*',\n}\nconst turndownFilter = ['script', 'footer', 'style', 'center', 'table'];\n\nconst turndownService = new TurndownService(turndownOptions);\nturndownService.remove(turndownFilter);\n\nexport const applyMarkdown = async (sourceHtml) => {\nconst $ = cheerio.load(sourceHtml)\n\n$('h1').children('a').contents().unwrap() //remove h1 anchor tag\n$('.menu-signup-container').remove()\n$('.site-header').children('center').remove()\n$('table').remove()\n$('title').remove()\n$('h1').remove()\nconst html = $.root().html() \t\t\t\n\nturndownService\n    .addRule('center align h2: entry-title', {\n      filter: (node, content) => /entry-title/.test(node.className),\n      replacement: (content, node) => {\n        const noBreakTag = content.replace(/\\<br\\>\\s/g,\"\")\n        const noLineBreak = noBreakTag.replace(/\\r?\\n|\\r/, \"\")  \n        return \"\\n\" + `{center}${noLineBreak}{/center}` +\"\\n\"+\"\\n\"\n      }\n    })\n\n    .addRule('chalk <strong> (<b>)', {\n      filter: \"strong\",\n      replacement: (content) => {\n        return `{bold}${content}{/bold}`\n      }\n    })\n\n    .addRule('replace <li> with unicode bullet' ,{\n      filter: 'li',\n      replacement: (content) => {\n        const bullet = figures.bullet\n        return `\n${bullet} ${content}`\n      }\n    })\n\n    .addRule('left align \\\"body\\\"', {\n      filter: (node, content) => /entry-content/.test(node.className),\n      replacement: (content) => `{left}${content}{/left}`\n    })\n\n    .addRule( \"sponsor\", { \n      filter: (node, content) => node.nodeType === 1 && node.localName === 'h3' && /[tT]hanks\\s?[Tt]o(.+?$)/.test(node.textContent),\n      replacement: (content) => {\n        let match = blessed.stripTags(content).match(/[tT]hanks\\s?[Tt]o(.+?$)/)\n        match = match[1].trim()\n        const orgLinkRegex = /(.*?)\\s\\[\\d\\d\\]/ \n        const orgFirstWordRegex = /^([\\S]+)/\n\n        if (orgLinkRegex.test(match)) {\n          match = match.match(orgLinkRegex)[1]\n        } else if (orgFirstWordRegex.test(match)) {\n          match = match.match(orgFirstWordRegex)[1]\n        } \n        return `{bold}${chalk.whiteBright(content)}{/bold} \n\n\n${figlet.textSync(match)}\n ` }})\n\n    .addRule( \"jobs\", { \nfilter: (node, content) => node.nodeType === 1 && node.localName === 'h3' && /[jJ]ob/.test(node.textContent),\n      replacement: (content) => {\n          return `${chalk.whiteBright(content)}`\n      }})\n\n    .addRule(\"chalk h6\", {\n      filter: 'h6',\n      replacement: (content) => {\n        let text = chalk.bgAnsi256(103).bold(content);\n        return chalk.bgAnsi256(103).bold(content)\n      }})\n\n\n    .addRule(\"advert image\", {\n      filter: 'img',\n      replacement: (content,node) => {\n        return \"\"\n      }})\n\n    .addRule('remove subscribe link', \n      {filter:(node) => {return /menu-1/.test(node.className)},\n        replacement: (node) => \"\"})\n\n    .addRule(\"link to terminalLink\", {\n      filter: 'a',\n      replacement: (content, node) => {\n        const url =  node.getAttribute('href');\n          return `{underline}${content}{/underline} $$${url}$$`\n      }})\n\n  let markdown = await turndownService.turndown(html);\n  markdown = markdown.trim()\n  markdown =  \"\\n\" + markdown \n  return {markdown};\n}\n"],"mappings":"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"}