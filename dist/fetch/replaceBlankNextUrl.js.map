{"version":3,"file":"replaceBlankNextUrl.js","names":["join","dirname","fileURLToPath","Low","JSONFile","__dirname","import","meta","url","file","adapter","db","replaceBlankNextUrl","dateLatestPub","setReplaceCycleInitd","read","data","newsletters","length","nl","i","date","nextUrl","addNextUrl","newObj","splice","write","checkContinuity","hasContinuity","prevUrl","push","Error","every","item"],"sources":["../../src/fetch/replaceBlankNextUrl.js"],"sourcesContent":["\nimport { join, dirname } from 'node:path'\nimport { fileURLToPath } from 'node:url'\n\nimport { Low } from 'lowdb'\nimport { JSONFile } from 'lowdb/node'\n\nconst __dirname = dirname(fileURLToPath(import.meta.url));\nconst file = join(__dirname, 'db.json')\nconst adapter = new JSONFile(file)\nconst db = new Low(adapter)\n\nexport async function replaceBlankNextUrl(dateLatestPub, setReplaceCycleInitd) {\n  await db.read()\n  db.data ||= { newsletters: [ ] }\n  const { newsletters } = db.data\n\n  if (newsletters.length > 1 && typeof dateLatestPub === 'string') {\n    let nl = newsletters\n    for (let i = 0; i < nl.length; i++) {\n      try {\n        if ( nl[i].date !== dateLatestPub && !nl[i].nextUrl.length) {\n          await addNextUrl(nl[i-1].url, i, nl)   \n        }\n      } catch(error) {\n        return\n      }\n    }\n    setReplaceCycleInitd(true)\n  } else if (newsletters.length <= 1) {\n    setReplaceCycleInitd(true)\n  }\n}\n\nasync function addNextUrl(nextUrl, i, nl) {\n  const newObj = {...nl[i], nextUrl}  \n  nl = nl.splice(i, 1, newObj) \n  await db.write()   \n}\n\nexport async function checkContinuity() {\n  await db.read()\n  db.data ||= { newsletters: [ ] }\n  const { newsletters } = db.data\n\n  let hasContinuity = []\n  for (let i = 0; i < newsletters.length -1; i++) {\n    if (newsletters[i].prevUrl !== newsletters[i + 1]?.url) {\n      hasContinuity.push(false)\n      throw new Error()\n    } else {\n      hasContinuity.push(true)\n    }\n  }\n  return hasContinuity.every((item) => item === true)\n}\n"],"mappings":"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"}